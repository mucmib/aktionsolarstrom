<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Solarstrom statt Erdgas-Strom – Brief einreichen</title>
  <link rel="stylesheet" href="assets/styles.css">
  <style>
    body { font-family: Arial, sans-serif; line-height: 1.6; margin: 0; padding: 0; }
    header { background: #000; color: #fff; padding: 20px; text-align: center; }
    header img { max-height: 60px; }
    main { max-width: 800px; margin: 20px auto; padding: 20px; }
    form label { display: block; margin-top: 15px; font-weight: bold; }
    form input, form textarea {
      width: 100%; padding: 10px; margin-top: 5px;
      border: 1px solid #ccc; border-radius: 4px;
    }
    form textarea { min-height: 220px; }
    .checkboxes { margin-top: 15px; }
    .checkboxes label { font-weight: normal; display: block; margin: 5px 0; }
    button {
      margin-top: 20px; padding: 12px 20px;
      background: #008000; color: #fff; border: none; border-radius: 4px;
      cursor: pointer; font-size: 16px;
    }
    button:hover { background: #006400; }
    .notice { margin-top: 20px; font-size: 0.9em; color: #555; }
    .success { margin-top: 20px; padding: 10px; background: #e0ffe0; border: 1px solid #0a0; }
  </style>
</head>
<body>
  <header>
    <img src="assets/logo.png" alt="Kampagnenlogo">
    <h1>Solarstrom statt Erdgas-Strom</h1>
    <p>Sie schreiben den Brief – wir übernehmen Ausdruck & Postversand an die Abgeordneten.</p>
  </header>

  <main>
    <h2>So funktioniert’s</h2>
    <ol>
      <li>Brieftext verfassen und Absenderadresse angeben.</li>
      <li>Der Brief geht an unser Kampagnenteam in die Druck-&-Post-Warteschlange.</li>
      <li>Wir drucken, kuvertieren und versenden physisch an die zuständige/n MdB.</li>
    </ol>

    <h2>Brief einreichen</h2>
    <form id="letterForm" method="post" action="/api/queue">
      <!-- Empfänger -->
      <label for="plz">Ihre PLZ *</label>
      <input type="text" id="plz" name="plz" required>

      <label for="ort">Ort *</label>
      <input type="text" id="ort" name="ort" required>

      <label for="abgeordneter">Name der/s Abgeordneten (optional)</label>
      <input type="text" id="abgeordneter" name="abgeordneter">

      <!-- Absender -->
      <label for="vorname">Vorname *</label>
      <input type="text" id="vorname" name="vorname" required>

      <label for="nachname">Nachname *</label>
      <input type="text" id="nachname" name="nachname" required>

      <label for="email">E-Mail *</label>
      <input type="email" id="email" name="email" required>

      <label for="strasse">Straße & Nr. *</label>
      <input type="text" id="strasse" name="strasse" required>

      <label for="plz_abs">PLZ (Absender:in) *</label>
      <input type="text" id="plz_abs" name="plz_abs" required>

      <label for="ort_abs">Ort (Absender:in) *</label>
      <input type="text" id="ort_abs" name="ort_abs" required>

      <!-- Brief -->
      <label for="subject">Betreff *</label>
      <input type="text" id="subject" name="subject" 
             value="Solarstrom vor Erdgas-Strom – bitte setzen Sie klare Prioritäten" required>

      <label for="message">Brieftext</label>
      <textarea id="message" name="message">
Sehr geehrte Damen und Herren,

bitte setzen Sie sich dafür ein, dass Solar-Direktstrom in Deutschland eindeutig Vorrang vor Erdgas-Strom hat – rechtlich wie praktisch. Es braucht:
- klare Prioritäten in Gesetzen und Verordnungen,
- Netz- und Marktdesign, das flexible Direktnutzung fördert,
- weniger Hürden für Prosumer, Kommunen und KMU.

Das stärkt Versorgungssicherheit, senkt Kosten und schützt unsere Lebensgrundlagen.

Mit freundlichen Grüßen
{Vorname} {Nachname}
{Straße}, {PLZ} {Ort}
      </textarea>

      <!-- Optionen -->
      <div class="checkboxes">
        <label><input type="checkbox" name="postversand" required> 
          Ich willige ein, dass mein Brief an das Kampagnenteam übermittelt, für den Postversand aufbereitet und in meinem Namen mit meiner Absenderadresse physisch versendet wird.
        </label>
        <label><input type="checkbox" name="copy"> 
          Kopie an mich per E-Mail senden
        </label>
      </div>

      <button type="submit">In Druckwarteschlange einreichen</button>

      <p class="notice">Hinweis: Sie erhalten eine Bestätigung mit Vorgangs-ID.</p>
      <div id="successMessage" class="success" style="display:none;"></div>
    </form>
  </main>

  <script>
    const form = document.getElementById('letterForm');
    const successBox = document.getElementById('successMessage');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Form -> Plain Object
      const data = Object.fromEntries(new FormData(form).entries());

      // Checkboxen sauber in Boolean umwandeln
      data.postversand = !!form.querySelector('input[name="postversand"]')?.checked;
      data.copy        = !!form.querySelector('input[name="copy"]')?.checked;

      // JSON senden
      const res = await fetch(form.action, {
        method: 'POST',
        headers: { 'Content-Type':'application/json' },
        body: JSON.stringify(data)
      });

      let json;
      try { json = await res.json(); } catch { json = {}; }

      if (res.ok && json.queueId) {
        successBox.style.display = 'block';
        successBox.textContent = 'Danke! Wir haben Ihren Brief erhalten. Vorgangs-ID: ' + json.queueId;
        form.reset();
      } else {
        alert('Fehler: ' + (json.error || json.detail || ('HTTP ' + res.status)));
      }
    });
  </script>
</body>
</html>
