<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aktionsolarstrom</title>
  <style>
    <script>
/**
 * Lädt PLZ→WK und WK→MdB und befüllt das Formular.
 * Erwartet folgende Feld-IDs in deiner bestehenden Seite:
 *  - PLZ:           #plz
 *  - MdB-Name:      #abgeordneter
 *  - Brieftext:     #message
 * JSON-Dateien:
 *  - /assets/data/plz_to_wk.json
 *  - /assets/data/wk_to_mdb.json   (liegt schon vor – 276 WK)
 */

async function findMdBByPLZ(plz) {
  try {
    const [plzMap, wkMap] = await Promise.all([
      fetch('/assets/data/plz_to_wk.json').then(r => r.ok ? r.json() : null),
      fetch('/assets/data/wk_to_mdb.json').then(r => r.ok ? r.json() : null),
    ]);
    if (!plzMap || !wkMap) return null;

    const wks = plzMap[plz];
    if (!wks || !wks.length) return null;

    // MVP: nimm den ersten Wahlkreis; (bei Mehrtreffern später Auswahl-UI)
    const wk = String(wks[0]);
    return wkMap[wk] || null;
  } catch {
    return null;
  }
}

function ensureIntroOnce(textarea, anredeZeile) {
  const current = textarea.value || '';
  // Nur dann voranstellen, wenn noch keine Anrede am Anfang steht
  if (!/^\s*Sehr\s/i.test(current)) {
    textarea.value = anredeZeile + "\n\n" + current.trimStart();
  }
}

document.getElementById('plz')?.addEventListener('change', async (e) => {
  const plz = (e.target.value || '').trim();
  if (!/^\d{5}$/.test(plz)) return;

  const mpInput = document.getElementById('abgeordneter');
  const msg = document.getElementById('message');
  if (!msg) return;

  const mdb = await findMdBByPLZ(plz);

  if (mdb) {
    if (mpInput) mpInput.value = mdb.mdb_name || '';
    // Anrede aus JSON verwenden
    const anrede = (mdb.anrede && mdb.anrede.trim()) ? mdb.anrede.trim() : "Sehr geehrte Damen und Herren";
    ensureIntroOnce(msg, anrede);
    // Optional: versteckte Adresse mitschicken (falls gewünscht)
    let addr = document.getElementById('mp_address');
    if (!addr) {
      addr = document.createElement('input');
      addr.type = 'hidden';
      addr.id = 'mp_address';
      addr.name = 'mp_address';
      msg.form?.appendChild(addr);
    }
    addr.value = mdb.bundestag_address || '';
  } else {
    // Fallback für fehlende/noch nicht abgedeckte WK
    if (mpInput) mpInput.value = '';
    ensureIntroOnce(msg, "Sehr geehrte Damen und Herren");
  }
});
</script>

    body {
      margin: 0;
      padding: 0;
      background-color: #000000; /* Schwarzer Hintergrund */
      color: #ffffff; /* Standard: weißer Text */
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      text-align: center;
    }
    h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
    }
    h2 {
      font-size: 1.8em;
      margin-bottom: 30px;
    }
    img {
      max-width: 300px;
      height: auto;
    }
  </style>
</head>
<body>
  <h1>In Kürze geht’s los</h1>
  <h2>Aktion</h2>
  <img src="assets/logo.png" alt="Kampagnenlogo">
</body>
</html>



