<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Solarstrom statt Erdgas-Strom – Wir drucken & versenden Ihren Brief</title>
  <meta name="description" content="Reichen Sie Ihren Brief ein – wir drucken, kuvertieren und versenden physisch an die zuständige Bundestagsabgeordnete.">
  <link rel="stylesheet" href="assets/styles.css">

  <style>
    :root { --accent:#0a7c5b; }
    /* 3-Spalten: Mitte Content */
    .page { display:grid; grid-template-columns:1fr minmax(0, 920px) 1fr; min-height:100dvh; }
    .middle { grid-column:2; width:100%; }

    /* Hero */
    .hero { display:flex; align-items:center; justify-content:center; gap:16px; flex-wrap:wrap; text-align:center; padding:24px 0; }
    .hero img { max-height:220px; width:auto; }
    .hero .cta { display:inline-block; margin-top:8px; }
    .tagline { color:#fff; }

    /* Layout */
    main.middle > section { margin: 24px 0; }
    .grid { display:grid; gap:12px; grid-template-columns:1fr; }
    @media(min-width:700px){ .grid{ grid-template-columns:1fr 1fr; } }

    /* Form UI */
    .checkbox-inline { display:flex; gap:.6rem; align-items:flex-start; margin:.4rem 0; }
    textarea#message { white-space:pre-wrap; }

    /* Actions */
    .actions { margin-top: 16px; }
    .actions button { background:var(--accent); color:#fff; border:0; padding:12px 16px; border-radius:10px; cursor:pointer; }
    .actions button[disabled]{ opacity:.6; cursor:not-allowed; }

    .disclaimer { color:#666; font-size:.95rem; }
    .notice { background:#f4fff8; border:1px solid #cfeede; padding:10px 12px; border-radius:8px; margin-top:8px; }
    .hidden { display:none !important; }

    footer .legal { text-align:center; display:block; }
  </style>
</head>
<body>
  <div class="page">
    <header class="site-header middle">
      <div class="hero">
        <img src="assets/logo.png" alt="Kampagnenlogo Solarstrom statt Erdgas-Strom">
        <div>
          <h1>Solarstrom statt Erdgas-Strom</h1>
          <p class="tagline">Sie schreiben den Brief – wir übernehmen Ausdruck und Postversand an die Abgeordneten.</p>
          <a class="cta" href="#brief">Brief einreichen</a>
        </div>
      </div>
    </header>

    <main class="middle">
      <section class="explainer">
        <h2>So funktioniert’s</h2>
        <ol>
          <li>Sie verfassen Ihren Brief (Vorlage unten) und geben Ihre <strong>Absenderadresse</strong> an.</li>
          <li>Der Brief geht <strong>an uns</strong> und landet in der Druck- &amp; Post-Warteschlange.</li>
          <li>Wir drucken, kuvertieren und versenden physisch an die zuständige/n MdB.</li>
        </ol>
        <p>Wir verarbeiten Ihre Daten ausschließlich zur Durchführung des Postversands (Details in der Datenschutzerklärung).</p>
      </section>

      <section id="brief" class="form-section">
        <h2>Brief einreichen</h2>

        <form id="campaign-form" method="post" action="/api/queue" novalidate>
          <!-- Ziel-Abgeordnete:r -->
          <fieldset>
            <legend>Ziel-Abgeordnete:r</legend>
            <p>Standard: Wir ermitteln die Postanschrift anhand Ihrer PLZ und unseres Adressverzeichnisses.</p>
            <div class="grid">
              <div>
                <label for="zip">Ihre PLZ *</label>
                <input id="zip" name="zip" pattern="\d{5}" inputmode="numeric" required placeholder="z. B. 10969">
              </div>
              <div>
                <label for="city">Ort *</label>
                <input id="city" name="city" required>
              </div>
            </div>
            <label for="mp_name">Name der/s Abgeordneten (optional)</label>
            <input id="mp_name" name="mp_name" placeholder="z. B. Max Mustermann, MdB">
          </fieldset>

          <!-- Absender -->
          <fieldset>
            <legend>Ihre Angaben (Absender:in)</legend>
            <div class="grid">
              <div>
                <label for="first_name">Vorname *</label>
                <input id="first_name" name="first_name" required>
              </div>
              <div>
                <label for="last_name">Nachname *</label>
                <input id="last_name" name="last_name" required>
              </div>
            </div>

            <label for="email">E-Mail für Rückfragen/Kopie *</label>
            <input id="email" name="email" type="email" required>

            <label for="street">Straße &amp; Nr. *</label>
            <input id="street" name="street" required>

            <div class="grid">
              <div>
                <label for="sender_zip">PLZ (Absender:in) *</label>
                <input id="sender_zip" name="sender_zip" pattern="\d{5}" required>
              </div>
              <div>
                <label for="sender_city">Ort (Absender:in) *</label>
                <input id="sender_city" name="sender_city" required>
              </div>
            </div>
          </fieldset>

          <!-- Brief (ein einziges, bearbeitbares Feld) -->
          <fieldset>
            <legend>Brief</legend>
            <div class="notice">Im Brieftext werden automatisch Ihre Angaben eingesetzt (Name/Adresse). Sie können den Text bei Bedarf anpassen.</div>

            <label for="subject">Betreff *</label>
            <input id="subject" name="subject" required value="Solarstrom vor Erdgas-Strom – bitte setzen Sie klare Prioritäten">

            <label for="message">Brieftext *</label>
            <textarea id="message" name="message" rows="18" required>
Sehr geehrte:r {Anrede_Name},

heute möchte ich mich an Sie wenden, um ihre Aufmerksamkeit auf ein Thema zu lenken das für sehr viele Bürgerinnen, Bürger und Unternehmen in Ihrem Wahlkreis sehr relevant ist: Die Fortsetzung der Energiewende.
Bürgerinnen, Bürger und Unternehmen investieren mit Photovoltaik und Speicher in die Energiewende und den Klimaschutz. Die eigene produzierte Energie wird direkt und über den Stromspeicher selber genutzt. Das ist ökonomisch und ökologisch sinnvoll.
Möglich wurde dies durch das EEG (Erneuerbare Energien Gesetz). Doch jetzt steht diese erfolgreiche Entwicklung vor dem Abbruch. Bundesministerin Reiche möchte die Energiewende drosseln, neue Erdgaskraftwerke bauen und die feste Einspeisevergütung abschaffen. Außerdem plant die Bundesnetzagentur mit ihrem Diskussionspapier AgNes eine massive Verschlechterung der Wirtschaftlichkeit für Produzenten von regenerativer Energie. Dagegen möchte ich mich mit diesem Brief an Sie wenden und die Forderungen der Initiative „Sonnenstrom statt Erdgasstrom“ unterstützen. Die Forderungen sind:

1. Keine neuen Erdgaskraftwerke. Spitzenlast mit Bioenergie, Wasserkraft und Speichern abdecken.

2. Ausbau Erneuerbarer beschleunigen – und netzdienliche Erzeugung belohnen.

3. Feste Einspeisevergütung beibehalten bis Smart Meter flächendeckend eine einfache, flexible Vergütung erlauben.

4. Bestandsschutz und keine Zusatzbelastung für erneuerbare Stromerzeugung.

Dieser Brief entstand im Zusammenhang der Aktion „Eigenstrom statt Kohlestrom“. Weitere Informationen zu den Plänen von Frau Reiche und der BNetzA finden Sie auf https://www.aktionsolarstrom.de.

Vielen Dank für ihre Aufmerksamkeit und Mühe. Es würde mich sehr freuen von Ihnen zu hören.

Mit freundlichen Grüßen

{Vorname} {Nachname}
{Straße}
{PLZ} {Ort}
            </textarea>

            <label class="checkbox-inline">
              <input id="consent_print" name="consent_print" type="checkbox" required>
              Ich willige ein, dass mein Brief an das Kampagnenteam übermittelt, für den <strong>Postversand</strong> aufbereitet
              und in meinem Namen mit meiner <strong>Absenderadresse</strong> physisch versendet wird.
            </label>

            <label class="checkbox-inline">
              <input id="copy_to_self" name="copy_to_self" type="checkbox" checked> Kopie an mich per E-Mail senden
            </label>
          </fieldset>

          <div class="actions">
            <button id="submitBtn" type="submit">In Druck-Warteschlange einreichen</button>
          </div>
          <p class="disclaimer">Hinweis: Sie erhalten eine Bestätigung mit Vorgangs-ID.</p>
          <div id="confirmBox" class="notice hidden" aria-live="polite"></div>
        </form>
      </section>

      <section class="faq">
        <h2>FAQ</h2>
        <details><summary>Welche Absenderdaten werden aufgedruckt?</summary><p>Standardmäßig Name, Straße, PLZ/Ort wie angegeben – notwendig für postalische Kommunikation.</p></details>
        <details><summary>Wie wählt ihr die MdB-Adresse?</summary><p>Über unser Adressverzeichnis (Bundestag/Wahlkreis). Standard ist die Bundestagsadresse.</p></details>
        <details><summary>Welche Daten speichert ihr?</summary><p>Nur das Notwendige für Nachweis, Druck &amp; Versand (Löschkonzept siehe Datenschutz).</p></details>
      </section>
    </main>

    <footer class="site-footer middle">
      <nav class="legal">
        <a href="Impressum.html">Impressum</a> · <a href="Datenschutz.html">Datenschutz</a>
      </nav>
      <p style="text-align:center">© Kampagne „Solarstrom statt Erdgas-Strom“</p>
    </footer>
  </div>

  <!-- MdB-Autoauswahl: PLZ -> Wahlkreis -> MdB (Pfade ggf. anpassen) -->
  <script>
  (() => {
    const PLZ_WK_URL = 'data/plz_to_wk.json';
    const WK_MDB_URL = 'data/wk_to_mdb.json';

    const zipEl = document.getElementById('zip');
    const cityEl = document.getElementById('city');
    const mpEl  = document.getElementById('mp_name');
    const msgEl = document.getElementById('message');

    let plzToWk = null;
    let wkToMdb = null;

    async function loadData() {
      if (!plzToWk) plzToWk = await fetch(PLZ_WK_URL).then(r => r.json());
      if (!wkToMdb) wkToMdb = await fetch(WK_MDB_URL).then(r => r.json());
    }

    function normalizePLZ(v) {
      return (v || '').toString().trim().replace(/\D/g,'').slice(0,5);
    }

    function setMdbInfo(mdb) {
      if (!mdb) return;
      if (mpEl && !mpEl.value.trim()) mpEl.value = mdb.name || '';
      // {MdB_Adresse} im Brief ersetzen (falls Platzhalter vorhanden)
      if (msgEl && mdb.adresse && msgEl.value.includes('{MdB_Adresse}')) {
        msgEl.value = msgEl.value.replace('{MdB_Adresse}', mdb.adresse);
      }
    }

    async function resolveMdbByPLZ() {
      const plz = normalizePLZ(zipEl.value);
      if (plz.length !== 5) return;

      try {
        await loadData();
        const wk = plzToWk[plz];
        if (!wk) return;

        const mdb = wkToMdb[wk] || wkToMdb[String(wk)] || null;
        setMdbInfo(mdb);
      } catch (e) {
        console.warn('MdB-Autofill fehlgeschlagen:', e);
      }
    }

    if (zipEl) {
      zipEl.addEventListener('change', resolveMdbByPLZ);
      zipEl.addEventListener('blur', resolveMdbByPLZ);
      zipEl.addEventListener('input', (e) => {
        const v = normalizePLZ(e.target.value);
        if (e.target.value !== v) e.target.value = v;
      });
    }
    if (cityEl) cityEl.addEventListener('blur', resolveMdbByPLZ);

    document.addEventListener('DOMContentLoaded', resolveMdbByPLZ);
  })();
  </script>

  <!-- Submit: Platzhalter einsetzen, POST senden, Bestätigungs-ID zeigen -->
  <script>
  (function () {
    const form = document.getElementById('campaign-form');
    const confirmBox = document.getElementById('confirmBox');
    const submitBtn = document.getElementById('submitBtn');

    function trim(v){ return (v||'').toString().trim(); }

    function buildMessage() {
      const mp = trim(document.getElementById('mp_name').value);
      const first = trim(document.getElementById('first_name').value);
      const last = trim(document.getElementById('last_name').value);
      const street = trim(document.getElementById('street').value);
      const plz = trim(document.getElementById('sender_zip').value);
      const ort = trim(document.getElementById('sender_city').value);

      let msg = document.getElementById('message').value;
      const anrede = mp ? mp : 'Abgeordnete:r';

      msg = msg.replaceAll('{Anrede_Name}', anrede)
               .replaceAll('{Vorname}', first)
               .replaceAll('{Nachname}', last)
               .replaceAll('{Straße}', street)
               .replaceAll('{PLZ}', plz)
               .replaceAll('{Ort}', ort);

      return msg;
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!form.reportValidity()) return;

      submitBtn.disabled = true;
      submitBtn.textContent = 'Wird eingereicht…';

      const payload = {
        zip: trim(document.getElementById('zip').value),
        city: trim(document.getElementById('city').value),
        mp_name: trim(document.getElementById('mp_name').value),
        first_name: trim(document.getElementById('first_name').value),
        last_name: trim(document.getElementById('last_name').value),
        email: trim(document.getElementById('email').value),
        street: trim(document.getElementById('street').value),
        sender_zip: trim(document.getElementById('sender_zip').value),
        sender_city: trim(document.getElementById('sender_city').value),
        subject: trim(document.getElementById('subject').value),
        message: buildMessage(),
        consent_print: document.getElementById('consent_print').checked,
        copy_to_self: document.getElementById('copy_to_self').checked
      };

      try {
        const res = await fetch(form.action, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        const data = await res.json().catch(() => ({}));
        if (!res.ok) {
          const msg = data && data.message ? data.message : 'Uups – das hat nicht geklappt. Bitte später erneut versuchen.';
          throw new Error(msg);
        }

        confirmBox.classList.remove('hidden');
        confirmBox.textContent = data.id
          ? `Danke! Ihr Brief wurde eingereicht. Vorgangs-ID: ${data.id}`
          : 'Danke! Ihr Brief wurde eingereicht.';
      } catch (err) {
        alert(err.message || 'Fehler beim Einreichen.');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'In Druck-Warteschlange einreichen';
      }
    });
  })();
  </script>
</body>
</html>






